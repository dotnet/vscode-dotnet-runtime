parameters:
  pool: ''
  SignType: ''
  version: ''

jobs:
  # Note: This step requires approval, allows for manual smoke testing the artifact before release
  - deployment: Deploy
    pool:
      vmImage: ${{ parameters.pool.vmImage }}
    displayName: '‚ú® Deploy to Release Environment'
    dependsOn:
    - ${{ parameters.pool.os }}_Package
    environment: 'vscode-dotnetcore-extension-releases'
  - job: Publish
    pool:
      vmImage: ${{ parameters.pool.vmImage }}
    displayName: 'üåê Publish to Marketplace'
    dependsOn:
    - Deploy
    - ${{ parameters.pool.os }}_Package
    variables:
      version: $[ dependencies.GetVersion.outputs['${{ parameters.version }}'] ]
    steps:
    - checkout: none # Skip checking out repo
    - task: DownloadPipelineArtifact@2
      displayName: '‚¨áÔ∏è Download Packaged Extension'
      inputs:
        path: '$(System.ArtifactsDirectory)'
    - template: install-node.yaml
    - bash: |
        npm install @vscode/vsce@latest -g --reg https://registry.npmjs.org/ --verbose
        vsce publish --packagePath vscode-dotnet-runtime-$(version)-signed.vsix -p $(VSCODE_MARKETPLACE_TOKEN)
      displayName: 'üçµ Publish to Marketplace'
      workingDirectory: '$(System.ArtifactsDirectory)/vscode-dotnet-runtime-extension'